(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-62b9672f"],{"0b4d":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"message"},[a("vueScroll",{ref:"vs"},[a("div",{staticClass:"msgCon"},[a("header",{staticClass:"header"},[a("h1",{staticClass:"name"},[t._v("留言板")]),a("h2",{staticClass:"num"},[t._v("已有"+t._s(t.total)+"人留下足迹")])]),a("Reply",{attrs:{row:8,_id:t.type,type:t.type},on:{reply:t.handleReply}}),a("div",{staticClass:"messageList"},[t._l(t.messageList,(function(e){return a("Comment",{key:e._id,staticClass:"messageItem",attrs:{type:t.type,comment:e},on:{likes:t.msgAction,dislikes:t.msgAction,reply:t.msgReply}})})),a("div",{staticClass:"flex flex-center"},[a("el-pagination",{attrs:{"current-page":t.currentPage,"page-size":t.query.pagesize,layout:"total, prev, pager, next",total:t.total,"hide-on-single-page":""},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e}}})],1)],2)],1)])],1)},n=[],r=a("5530"),i=a("365c"),c=a("f2f6"),o=a("4cf6"),l={name:"message",components:{Reply:c["a"],Comment:o["a"]},data:function(){return{type:"msg",messageList:[],total:0,query:{page:0,pagesize:5},currentPage:0}},created:function(){this.$store.commit("menu/setAside",!0)},mounted:function(){this.loadMessages()},methods:{handleCurrentChange:function(t){this.query.page=t-1,this.loadMessages()},msgReply:function(t){var e=this;Object(i["b"])("/message/reply",Object(r["a"])({},t)).then((function(){e.$message({showClose:!0,message:"留言成功",type:"success"}),e.loadMessages()}))},msgAction:function(t){var e=this;Object(i["a"])("/message/update",Object(r["a"])({},t)).catch((function(t){e.$message({type:"error",message:t})}))},loadMessages:function(){var t=this;Object(i["a"])("/message/search",Object(r["a"])({},this.query)).then((function(e){t.messageList=e.data.data,t.total=e.data.total}))},handleReply:function(t){var e=this;Object(i["b"])("/message/create",this.formatParms(t)).then((function(){e.$message({type:"success",message:"成功踩点。23333"}),e.loadMessages()}))},formatParms:function(t){return Object(r["a"])(Object(r["a"])({},t),{},{ip:localStorage.getItem("ip"),city:localStorage.getItem("cityname")})}}},m=l,u=(a("9dd1"),a("2877")),p=Object(u["a"])(m,s,n,!1,null,"b1d81836",null);e["default"]=p.exports},2374:function(t,e,a){},"4cf6":function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"comment"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{staticClass:"text-center",attrs:{span:2}},["cmt"===t.type?a("el-avatar",{attrs:{src:t.comment.author.avatar}}):a("el-avatar",{attrs:{src:t.comment.avatar}},[t._v(" "+t._s(t.comment.name[0])+" ")])],1),a("el-col",{attrs:{span:22}},[a("div",{staticClass:"content"},[a("div",{staticClass:"author flex flex-wrap"},["cmt"===t.type&&t.comment.author?a("span",{staticClass:"name mr10 fs13"},[t._v(t._s(t.comment.author.name))]):a("span",{staticClass:"name mr10 fs13"},[t._v(t._s(t.comment.name))]),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.formatTime(t.comment.createdAt).format,placement:"top"}},[a("span",{staticClass:"time mr10 fs13"},[t._v(t._s(t.formatTime(t.comment.createdAt).distance))])]),t.comment.replyed?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.comment.replyed.content,placement:"top"}},[t.comment.replyed&&"cmt"===t.type&&t.comment.replyed.author?a("span",{staticClass:"fs13 replyed"},[t._v(" 回复 "),a("span",{staticClass:"name"},[t._v("@"+t._s(t.comment.replyed.author.name)+"：")])]):a("span",{staticClass:"fs13 replyed"},[t._v(" 回复 "),a("span",{staticClass:"name"},[t._v("@"+t._s(t.comment.replyed.name)+"：")])])]):t._e()],1),a("p",{staticClass:"text fs14 lh1-5"},[t._v(t._s(t.comment.content))]),a("ul",{staticClass:"actions mt10 mb10"},[a("li",{on:{"~click":function(e){return t.handleActionLike("likes")}}},[a("div",{staticClass:"pr pl20 cursor"},[a("div",{staticClass:"like pa",class:t.likes?"active":""}),a("span",{staticClass:"ml5 fs13"},[t._v(t._s(t.comment.likes))])])]),a("li",{on:{"~click":function(e){return t.handleActionLike("dislikes")}}},[a("i",{staticClass:"iconfont iconnoxin mr5 fs16"}),a("span",[t._v(t._s(t.comment.dislikes))])]),a("li",{on:{click:t.thToggleReply}},[a("span",[a("i",{staticClass:"el-icon-chat-line-square mr5 fs15"}),a("span",[t._v("Reply to")])])])]),a("el-collapse-transition",[a("Reply",{directives:[{name:"show",rawName:"v-show",value:t.showReply,expression:"showReply"}],staticClass:"mt20 mb20",attrs:{type:t.type,_id:t.comment._id,placeholder:"cmt"===t.type?"回复"+t.comment.author.name+":":"回复"+t.comment.name+":"},on:{reply:t.handleReply}})],1),t.comment.children&&t.comment.children.length?[t._l(t.comment.children,(function(e,s){return[a("el-collapse-transition",{key:e._id},[s<t.capacity?a("comment",{attrs:{type:t.type,comment:e},on:{reply:t.reply,likes:t.childAction,dislikes:t.childAction}}):t._e()],1)]})),t.comment.children&&t.comment.children.length>t.defaultChildNum?[t.noMore?a("p",{staticClass:"flex flex-items-center flex-center"},[a("el-tooltip",{attrs:{effect:t.model?"light":"dark",content:"收起",placement:"top"}},[a("el-link",{attrs:{underline:!1},on:{click:function(e){t.capacity=t.defaultChildNum}}},[a("span",{staticClass:"fs13"},[t._v("没有更多啦~.~")]),a("i",{staticClass:"fs13 el-icon-d-arrow-right ml5",staticStyle:{transform:"rotate(-90deg)"}})])],1)],1):a("p",{staticClass:"flex flex-items-center flex-center"},[a("el-link",{attrs:{underline:!1},on:{click:t.loadMore}},[a("span",{staticClass:"fs13"},[t._v("加载更多")]),a("i",{staticClass:"fs13 ml5",class:t.loading?"el-icon-loading":"el-icon-d-arrow-right",staticStyle:{transform:"rotate(90deg)"}})])],1)]:t._e()]:t._e()],2)])],1)],1)},n=[],r=a("5530"),i=a("f2f6"),c=a("c1df"),o=a.n(c),l=a("ed08"),m=a("2f62"),u={name:"comment",components:{Reply:i["a"]},props:{comment:Object,type:{type:String,default:"cmt"}},data:function(){return{name:"",email:"",loading:!1,likes:!1,dislikes:!1,showReply:!1,accumulateNum:5,defaultChildNum:3,capacity:3}},computed:Object(r["a"])(Object(r["a"])({},Object(m["b"])("user",["model"])),{},{noMore:function(){return this.capacity>=this.comment.children.length}}),methods:{loadMore:function(){var t=this;this.loading=!0,setTimeout((function(){t.capacity+=t.accumulateNum,t.loading=!1}),350)},toggleReply:function(){this.showReply=!this.showReply},childAction:function(t){this.$emit(t.type,Object(r["a"])({},t))},handleActionLike:function(t){this[t]=!0,this.comment[t]++,this.$emit(t,{_id:this.comment._id,type:t})},thToggleReply:Object(l["b"])("toggleReply",500),formatTime:function(t){return{distance:Object(l["a"])(+new Date(t)),format:o()(t).format("YYYY-MM-DD HH:mm:ss")}},handleReply:function(t){this.showReply=!1,this.$emit("reply",t)},reply:function(t){this.$emit("reply",t)}}},p=u,f=(a("d196"),a("2877")),d=Object(f["a"])(p,s,n,!1,null,"4c47710c",null);e["a"]=d.exports},5899:function(t,e){t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(t,e,a){var s=a("1d80"),n=a("5899"),r="["+n+"]",i=RegExp("^"+r+r+"*"),c=RegExp(r+r+"*$"),o=function(t){return function(e){var a=String(s(e));return 1&t&&(a=a.replace(i,"")),2&t&&(a=a.replace(c,"")),a}};t.exports={start:o(1),end:o(2),trim:o(3)}},7156:function(t,e,a){var s=a("861d"),n=a("d2bb");t.exports=function(t,e,a){var r,i;return n&&"function"==typeof(r=e.constructor)&&r!==a&&s(i=r.prototype)&&i!==a.prototype&&n(t,i),t}},"9dd1":function(t,e,a){"use strict";var s=a("f694"),n=a.n(s);n.a},a9e3:function(t,e,a){"use strict";var s=a("83ab"),n=a("da84"),r=a("94ca"),i=a("6eeb"),c=a("5135"),o=a("c6b6"),l=a("7156"),m=a("c04e"),u=a("d039"),p=a("7c73"),f=a("241c").f,d=a("06cf").f,h=a("9bf2").f,y=a("58a8").trim,g="Number",v=n[g],_=v.prototype,b=o(p(_))==g,C=function(t){var e,a,s,n,r,i,c,o,l=m(t,!1);if("string"==typeof l&&l.length>2)if(l=y(l),e=l.charCodeAt(0),43===e||45===e){if(a=l.charCodeAt(2),88===a||120===a)return NaN}else if(48===e){switch(l.charCodeAt(1)){case 66:case 98:s=2,n=49;break;case 79:case 111:s=8,n=55;break;default:return+l}for(r=l.slice(2),i=r.length,c=0;c<i;c++)if(o=r.charCodeAt(c),o<48||o>n)return NaN;return parseInt(r,s)}return+l};if(r(g,!v(" 0o1")||!v("0b1")||v("+0x1"))){for(var k,x=function(t){var e=arguments.length<1?0:t,a=this;return a instanceof x&&(b?u((function(){_.valueOf.call(a)})):o(a)!=g)?l(new v(C(e)),a,x):C(e)},w=s?f(v):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),I=0;w.length>I;I++)c(v,k=w[I])&&!c(x,k)&&h(x,k,d(v,k));x.prototype=_,_.constructor=x,i(n,g,x)}},d196:function(t,e,a){"use strict";var s=a("d975"),n=a.n(s);n.a},d975:function(t,e,a){},e29a:function(t,e,a){"use strict";var s=a("2374"),n=a.n(s);n.a},ed08:function(t,e,a){"use strict";function s(t){var e,a=6e4,s=60*a,n=24*s,r=30*n,i=(new Date).getTime(),c=i-t;if(!(c<0)){var o=c/r,l=c/(7*n),m=c/n,u=c/s,p=c/a;return e=o>=1?o<=12?parseInt(o)+"月前":parseInt(o/12)+"年前":l>=1?parseInt(l)+"周前":m>=1?parseInt(m)+"天前":u>=1?parseInt(u)+"小时前":p>=1?parseInt(p)+"分钟前":"刚刚",e}}function n(t,e){var a=Date.now();return function(){var s=Date.now();s-a>e&&(this[t](),a=Date.now())}}a.d(e,"a",(function(){return s})),a.d(e,"b",(function(){return n}))},f2f6:function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"reply replyComponent"},[a("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"60px",size:"small","hide-required-asterisk":""}},[a("el-form-item",{attrs:{prop:"content"}},[a("div",{staticClass:"text-center",attrs:{slot:"label"},slot:"label"},[t.userInfo?a("el-avatar",{attrs:{src:t.userInfo.avatar}}):t._e()],1),a("el-input",{staticClass:"textarea",attrs:{type:"textarea",placeholder:t.placeholder,autosize:{minRows:t.row,maxRows:t.row}},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}})],1),a("el-form-item",[a("div",{staticClass:"flex flex-between"},["msg"===t.type?[a("el-input",{staticClass:"mr20",staticStyle:{"max-width":"200px"},attrs:{placeholder:"取个nice的网名吧~~"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}}),a("el-input",{staticClass:"mr20",staticStyle:{"max-width":"200px"},attrs:{placeholder:"Email 地址~~"},model:{value:t.form.email,callback:function(e){t.$set(t.form,"email",e)},expression:"form.email"}})]:t._e(),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.onSubmit}},[t._v("reply")])],2)])],1),"msg"===t.type?a("p",{staticClass:"remark"},[a("span",{staticClass:"title"},[t._v("隐私说明：")]),t._v("您可以放心的输入，您的Email 地址不会被公开显示，您的 IP 地址会被保存，但只会公开显示您当前所在的城市名。 ")]):t._e()],1)},n=[],r=(a("a9e3"),a("5530")),i=a("2f62"),c={name:"reply",props:{_id:{type:String,required:!0},type:{type:String,required:!0},row:{type:Number,default:5},placeholder:{type:String,default:"请您畅所欲言吧~~"}},data:function(){return{form:{content:"",name:"",email:""},rules:{content:[{required:!0,message:"是您的键盘坏了吗~·",trigger:"blur"}]}}},computed:Object(r["a"])({},Object(i["b"])("user",["userInfo"])),methods:{onSubmit:function(){var t=this;this.$refs.form.validate((function(e){if(e){var a={_id:t._id};return"cmt"===t.type?a.content=t.form.content:a=Object(r["a"])(Object(r["a"])({},a),t.form),t.$emit("reply",a),t.form.content="",!0}return!1}))}}},o=c,l=(a("e29a"),a("2877")),m=Object(l["a"])(o,s,n,!1,null,"9a5b5768",null);e["a"]=m.exports},f694:function(t,e,a){}}]);